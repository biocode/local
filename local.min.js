!function e(t,r,n){function i(o,a){if(!r[o]){if(!t[o]){var u="function"==typeof require&&require;if(!a&&u)return u(o,!0);if(s)return s(o,!0);throw new Error("Cannot find module '"+o+"'")}var l=r[o]={exports:{}};t[o][0].call(l.exports,function(e){var r=t[o][1][e];return i(r?r:e)},l,l.exports,e,t,r,n)}return r[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t){var r=["null","self","console","atob","btoa","setTimeout","clearTimeout","setInterval","clearInterval","Proxy","importScripts","navigator","postMessage","addEventListener","removeEventListener","onmessage","onerror","onclose","dispatchEvent"],n=["XMLHttpRequest","WebSocket","EventSource","FileReaderSync","Worker"],i=["(function() {","var nulleds=[];",'var whitelist = ["'+r.join('", "')+'"];',"for (var k in self) {","if (whitelist.indexOf(k) === -1) {","Object.defineProperty(self, k, { value: null, configurable: false, writable: false });","nulleds.push(k);","}","}",'var blacklist = ["'+n.join('", "')+'"];',"blacklist.forEach(function(k) {","Object.defineProperty(self, k, { value: null, configurable: false, writable: false });","nulleds.push(k);","});",'if (typeof console != "undefined") { console.log("Nullified: "+nulleds.join(", ")); }',"})();\n"].join(""),s=["(function() {","var orgImportScripts = importScripts;","function joinRelPath(base, relpath) {","if (relpath.charAt(0) == '/') {",'return "{{HOST}}" + relpath;',"}","// totally relative, oh god","// (thanks to geoff parker for this)",'var hostpath = "{{HOST_DIR_PATH}}";',"var hostpathParts = hostpath.split('/');","var relpathParts = relpath.split('/');","for (var i=0, ii=relpathParts.length; i < ii; i++) {","if (relpathParts[i] == '.')","continue; // noop","if (relpathParts[i] == '..')","hostpathParts.pop();","else","hostpathParts.push(relpathParts[i]);","}","return \"{{HOST}}/\" + hostpathParts.join('/');","}","var isImportingAllowed = true;","setTimeout(function() { isImportingAllowed = false; },0);","importScripts = function() {",'if (!isImportingAllowed) { throw "Local.js - Imports disabled after initial load to prevent data-leaking"; }',"return orgImportScripts.apply(null, Array.prototype.map.call(arguments, function(v, i) {","return (v.indexOf('/') < v.indexOf(/[.:]/) || v.charAt(0) == '/' || v.charAt(0) == '.') ? joinRelPath('{{HOST_DIR_URL}}',v) : v;","}));","};","})();\n"].join("\n");t.exports={logAllExceptions:!1,maxActiveWorkers:10,workerBootstrapScript:i+s}},{}],2:[function(e,t){t.exports={LINK_NOT_FOUND:1}},{}],3:[function(e,t){function r(e){var r=new t.exports.Request(e);return r.bufferResponse(!0),i.nextTick(function(){r.end()}),r}function n(e){return function(t,n){return r({method:e,url:t,params:n})}}var i=e("./util");t.exports={Request:e("./web/request.js"),Response:e("./web/response.js"),UriTemplate:e("./web/uri-template.js"),util:i,schemes:e("./web/schemes.js"),httpHeaders:e("./web/http-headers.js"),contentTypes:e("./web/content-types.js")},i.mixin.call(t.exports,e("./constants.js")),i.mixin.call(t.exports,e("./config.js")),i.mixin.call(t.exports,e("./promises.js")),i.mixin.call(t.exports,e("./request-event.js")),i.mixin.call(t.exports,e("./web/helpers.js")),i.mixin.call(t.exports,e("./web/httpl.js")),t.exports.dispatch=r,t.exports.HEAD=n("HEAD"),t.exports.GET=n("GET"),t.exports.POST=n("POST"),t.exports.PUT=n("PUT"),t.exports.PATCH=n("PATCH"),t.exports.DELETE=n("DELETE"),t.exports.SUBSCRIBE=n("SUBSCRIBE"),t.exports.NOTIFY=n("NOTIFY");var s,o=t.exports;"undefined"!=typeof window?s=window:"undefined"!=typeof self&&(s=self),s&&(s.local=o,s.HEAD=o.HEAD,s.GET=o.GET,s.POST=o.POST,s.PUT=o.PUT,s.PATCH=o.PATCH,s.DELETE=o.DELETE,s.SUBSCRIBE=o.SUBSCRIBE,s.NOTIFY=o.NOTIFY)},{"./config.js":1,"./constants.js":2,"./promises.js":4,"./request-event.js":5,"./util":8,"./web/content-types.js":9,"./web/helpers.js":10,"./web/http-headers.js":11,"./web/httpl.js":12,"./web/request.js":15,"./web/response.js":16,"./web/schemes.js":17,"./web/uri-template.js":18}],4:[function(e,t){function r(e){return e&&"function"==typeof e.then}function n(e){this.succeedCBs=[],this.failCBs=[],this.__hasValue=!1,this.__hasFailed=!1,this.value=void 0,e&&this.fulfill(e)}function i(e,t,n){if(null===n)e.isRejected()?t.reject(e.value):t.fulfill(e.value);else{var i;try{i=n(e.value)}catch(s){return(c.logAllExceptions||s instanceof Error)&&(console.error?console.error(s,s.stack):console.log("Promise exception thrown",s,s.stack)),t.reject(s)}r(i)?l(i).chain(t):t.fulfill(i)}}function s(e,t){Array.isArray(e)||(e=[e]);var r=l(),n=e.length,i=0;if(0===n)return r.fulfill([]),r;var s=[];s.length=n;for(var o=[],a=function(e,a,u){s[a]=e,u&&o.push(a),++i==n&&(t?t(s,o)?r.fulfill(s):r.reject(s):r.fulfill(s))},u=0;n>u;u++)l(e[u]).succeed(a,u,!1).fail(a,u,!0);return r}function o(e){return s(e,function(e,t){return 0===t.length})}function a(e){return s(e,function(e,t){return t.length<e.length})}function u(e){var t;try{t=e()}catch(n){return(c.logAllExceptions||n instanceof Error)&&(console.error?console.error(n,n.stack):console.log("Promise exception thrown",n,n.stack)),l().reject(n)}return r(t)?t:l(t)}function l(e){if(arguments.length>1)return s(Array.prototype.slice.call(arguments));if(e instanceof n)return e;if(r(e)){var t=l();return e.then(function(e){t.fulfill(e)},function(e){t.reject(e)}),t}return new n(e)}var c=e("./config.js"),f=e("./util");n.prototype.isUnfulfilled=function(){return!this.__hasValue},n.prototype.isRejected=function(){return this.__hasFailed},n.prototype.isFulfilled=function(){return this.__hasValue&&!this.__hasFailed},n.prototype.then=function(e,t){e=e&&"function"==typeof e?e:null,t=t&&"function"==typeof t?t:null;var r=l();if(this.isUnfulfilled())this.succeedCBs.push({p:r,fn:e}),this.failCBs.push({p:r,fn:t});else{var n=this;f.nextTick(function(){n.isFulfilled()?i(n,r,e):i(n,r,t)})}return r},n.prototype.succeed=function(e){if(this.isRejected())return this;var t=Array.prototype.slice.call(arguments,1);return this.then(function(r){return e.apply(null,[r].concat(t))})},n.prototype.fail=function(e){if(this.isFulfilled())return this;var t=Array.prototype.slice.call(arguments,1);return this.then(null,function(r){return e.apply(null,[r].concat(t))})},n.prototype.always=function(e){return this.then(e,e)},n.prototype.fulfill=function(e){if(this.isUnfulfilled()){this.value=e,this.__hasValue=!0;for(var t=0;t<this.succeedCBs.length;t++){var r=this.succeedCBs[t];i(this,r.p,r.fn)}this.succeedCBs.length=0,this.failCBs.length=0}return this},n.prototype.reject=function(e){if(this.isUnfulfilled()){this.value=e,this.__hasValue=!0,this.__hasFailed=!0;for(var t=0;t<this.failCBs.length;t++){var r=this.failCBs[t];i(this,r.p,r.fn)}this.succeedCBs.length=0,this.failCBs.length=0}return this},n.prototype.cancel=function(){var e;for(e=0;e<this.succeedCBs.length;e++)this.succeedCBs[e].p.cancel();for(e=0;e<this.failCBs.length;e++)this.failCBs[e].p.cancel();return this.succeedCBs.length=0,this.failCBs.length=0,this},n.prototype.chain=function(e){return this.then(function(t){return l(e).fulfill(t),t},function(t){return l(e).reject(t),t}),e},n.prototype.cb=function(e,t){e?this.reject(e):this.fulfill("undefined"==typeof t?null:t)},t.exports={Promise:n,promise:l,isPromiselike:r},l.bundle=s,l.all=o,l.any=a,l.lift=u},{"./config.js":1,"./util":8}],5:[function(e,t){function r(e,t){e.__localEventHandlers=[],t=t||{};var r;t.links!==!1&&(r={name:"click",handleEvent:i,container:e},e.addEventListener("click",r,!1),e.__localEventHandlers.push(r)),t.forms!==!1&&(r={name:"click",handleEvent:s,container:e},e.addEventListener("click",r,!0),e.__localEventHandlers.push(r),r={name:"submit",handleEvent:o,container:e},e.addEventListener("submit",r,!1),e.__localEventHandlers.push(r))}function n(e){e.__localEventHandlers&&(e.__localEventHandlers.forEach(function(t){e.removeEventListener(t.name,t)}),delete e.__localEventHandlers)}function i(e){if(0===e.button){var t=a.extractRequest.fromAnchor(e.orgtarget||e.target);if(!t||-1===["_top","_blank"].indexOf(t.target))return t?(e.preventDefault(),e.stopPropagation(),a.dispatchRequestEvent(e.target,t),!1):void 0}}function s(e){0===e.button&&a.trackFormSubmitter(e.target)}function o(e){var t=a.extractRequest(e.target,this.container);if(!t||-1===["_top","_blank"].indexOf(t.target))return t?(e.preventDefault(),e.stopPropagation(),a.finishPayloadFileReads(t).then(function(){a.dispatchRequestEvent(e.target,t)}),!1):void 0}var a=e("./util");t.exports={bindRequestEvents:r,unbindRequestEvents:n}},{"./util":8}],6:[function(e,t){function r(e,t){for(;e;){if(t(e))return e;e=e.parentNode}return null}function n(){for(var e,t=Array.prototype.slice.call(arguments),r={};t.length;)if(e=t.shift())for(var i in e)"undefined"!=typeof e[i]&&null!==e[i]&&(r[i]="object"!=typeof e[i]||Array.isArray(e[i])?e[i]:n(r[i],e[i]));return r}function i(e,t){var r=new CustomEvent("request",{bubbles:!0,cancelable:!0,detail:t});e.dispatchEvent(r)}function s(e){var t=r.thatisFormRelated(e);if(t){for(var n=0;n<t.form.length;n++)t.form[n].setAttribute("submitter",null);t.setAttribute("submitter","1")}}function o(e,t){var i={form:{},elem:{}},s=null;if("FORM"===e.tagName)s=e;else{var u=e.getAttribute("form");u&&(s=t.querySelector("#"+u)),s||(s=r.byTag(e,"FORM"))}var l=a(e,s);s&&(i.form=o.fromForm(s,e)),"A"===e.tagName?i.elem=o.fromAnchor(e):-1===["FORM","FIELDSET"].indexOf(e.tagName)&&(i.elem=o.fromFormElement(e));var c=n(i.form,i.elem),f={};return f[/GET/i.test(c.method)?"query":"body"]=l,n(c,f)}function a(e,t,n){n||(n={});var i={};n.nofiles||(i.__fileReads=[]);for(var s=0;s<t.length;s++){var o=t[s];if(o.name&&(!e||r.byElement(o,e))){var a="1"==o.getAttribute("submitter");if("BUTTON"===o.tagName)a&&Object.defineProperty(i,o.name,{configurable:!0,enumerable:!0,writable:!1,value:o.value});else if("INPUT"===o.tagName)switch(o.type.toLowerCase()){case"button":case"submit":a&&Object.defineProperty(i,o.name,{configurable:!0,enumerable:!0,writable:!1,value:o.value});break;case"checkbox":o.checked&&(i[o.name]=(i[o.name]||[]).concat(o.value));break;case"radio":null!==o.getAttribute("checked")&&(i[o.name]=o.value);break;case"file":if(n.nofiles)break;if(o.multiple){for(var l,s=0;l=o.files[s];s++)u(i,o,o.files[s],s);i[o.name]=[],i[o.name].length=s}else u(i,o,o.files[0]);break;default:i[o.name]=o.value}else i[o.name]=o.value}}return i}function u(e,t,r,n){if(r){var i=new FileReader;i.onloadend=l(e,t,r,n),i.readAsDataURL(r)}}function l(t,r,n,i){var s=e("../promises.js").promise();return t.__fileReads.push(s),function(e){var t={content:e.target.result||null,name:n.name,formattr:r.name,size:n.size,type:n.type,lastModifiedDate:n.lastModifiedDate};"undefined"!=typeof i&&(t.formindex=i),s.fulfill(t)}}function c(t){var r=t.body?t.body.__fileReads:t.query?t.query.__fileReads:[];return e("../promises.js").promise.bundle(r).then(function(e){return t.body&&delete t.body.__fileReads,t.query&&delete t.query.__fileReads,e.forEach(function(e){"undefined"!=typeof e.formindex?t.body[e.formattr][e.formindex]=e:t.body[e.formattr]=e}),t})}"undefined"==typeof CustomEvent&&(CustomEvent=function(e,t){var r=document.createEvent("CustomEvent");return r.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),r}),r.byTag=function(e,t){return r(e,function(e){return e.tagName==t})},r.byTagOrAlias=function(e,t){return r(e,function(e){return e.tagName==t||e.dataset&&e.dataset.localAlias&&e.dataset.localAlias.toUpperCase()==t})},r.byClass=function(e,t){return r(e,function(e){return e.classList&&e.classList.contains(t)})},r.byElement=function(e,t){return r(e,function(e){return e===t})},r.thatisFormRelated=function(e){return r(e,function(e){return!!e.form})},o.fromAnchor=function(e){if(e=r.byTagOrAlias(e,"A"),!e||!e.attributes.href||"#"==e.attributes.href.value.charAt(0))return null;var t={method:e.getAttribute("method"),url:e.attributes.href.value,target:e.getAttribute("target"),headers:{accept:e.getAttribute("type")}};return t},o.fromFormElement=function(e){var t={method:e.getAttribute("formmethod"),url:e.getAttribute("formaction"),target:e.getAttribute("formtarget"),headers:{"content-type":e.getAttribute("formenctype"),accept:e.getAttribute("formaccept")}};return t},o.fromForm=function(e,t){if(t&&!t.form)for(var i=0;i<e.length;i++){var s=e[i];if("1"==s.getAttribute("submitter")){t=s,s.setAttribute("submitter","0");break}}var a={submitter:{},fieldset:{},form:{}};if(t){a.submitter={method:t.getAttribute("formmethod"),url:t.getAttribute("formaction"),target:t.getAttribute("formtarget"),headers:{"content-type":t.getAttribute("formenctype"),accept:t.getAttribute("formaccept")}};for(var u=t,l=function(e){return"FIELDSET"==e.tagName||"FORM"==e.tagName};(u=r(u.parentNode,l))&&"FORM"!=u.tagName;)u&&(a.fieldset=n(o.fromFormElement(u),a.fieldset))}a.form={method:e.getAttribute("method"),url:e.getAttribute("action"),target:e.getAttribute("target"),headers:{"content-type":e.getAttribute("enctype")||e.enctype,accept:e.getAttribute("accept")}},e.acceptCharset&&(a.form.headers.accept=e.acceptCharset);var c=n(a.form,a.fieldset,a.submitter);return c},t.exports={findParentNode:r,trackFormSubmitter:s,dispatchRequestEvent:i,extractRequest:o,extractRequestPayload:a,finishPayloadFileReads:c}},{"../promises.js":4}],7:[function(e,t){function r(){Object.defineProperty(this,"_events",{value:{},configurable:!1,enumerable:!1,writable:!0})}t.exports=r,r.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments),r=this._events[e];if(!r)return!1;t=t.slice(1);for(var n=0,i=r.length;i>n;n++)r[n].apply(this,t);return!0},r.prototype.addListener=function(e,t){if(Array.isArray(e))return e.forEach(function(e){this.addListener(e,t)},this),void 0;if("function"!=typeof t)throw new Error("addListener only takes instances of Function");return this.emit("newListener",e,t),this._events[e]?this._events[e].push(t):this._events[e]=[t],this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){var r=this;return r.on(e,function n(){r.removeListener(e,n),t.apply(this,arguments)}),this},r.prototype.removeListener=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");if(!this._events[e])return this;var r=this._events[e],n=r.indexOf(t);return 0>n?this:(r.splice(n,1),0===r.length&&delete this._events[e],this)},r.prototype.removeAllListeners=function(e){return e?this._events[e]=null:this._events={},this},r.prototype.clearEvents=function(){for(var e in this._events)this.removeAllListeners(e);return this},r.prototype.listeners=function(e){return this._events[e]}},{}],8:[function(e,t){function r(e){for(var t in e)this[t]=e[t]}function n(e){o.call(e),r.call(e,o.prototype)}function i(e){return JSON.parse(JSON.stringify(e))}var s,o=e("./event-emitter.js"),a=e("./dom.js");if("undefined"==typeof window||window.ActiveXObject||!window.postMessage)s=function(e){setTimeout(e,0)};else{var u=0,l={};s=function(e){if("function"!=typeof e)throw"Invalid function provided to nextTick";window.postMessage("nextTick"+u,"*"),l["nextTick"+u]=e,u++},window.addEventListener("message",function(e){var t=l[e.data];t&&(delete l[e.data],t())},!0)}t.exports={EventEmitter:o,mixin:r,mixinEventEmitter:n,deepClone:i,nextTick:s},r.call(t.exports,a)},{"./dom.js":6,"./event-emitter.js":7}],9:[function(e,t){function r(e){switch(e){case"plain":case"plaintext":case"text":return"text/plain";case"html":return"text/html";case"csv":return"text/csv";case"events":case"event-stream":return"text/event-stream";case"json":return"application/json";case"xml":return"application/xml";case"javascript":case"js":return"application/javascript";case"form":case"urlencoded":return"application/x-www-form-urlencoded"}return e}function n(e,t){if(!t||"object"!=typeof t||!e)return t;var r=a(e,"serializer");return r?r(t):t}function i(e,t){if(!t||"string"!=typeof t||!e)return t;var r=a(e,"deserializer");if(!r)return t;try{return r(t)}catch(n){return console.warn("Failed to deserialize content",e,t),t}}function s(e,t,r){c[e]={serializer:t,deserializer:r}}function o(e){var t=e.split(";"),r=t[0];if(t=r.split("/"),t[1]){var n=t[1].split("+");return n[1]?[r,t[0]+"/"+n[1],t[0]]:[r,t[0]]}return[r]}function a(e,t){for(var r=o(e),n=0;n<r.length;n++)if(r[n]in c)return c[r[n]][t];return null}function u(e){var t=e.indexOf(":");return[e.slice(0,t).trim(),e.slice(t+1).trim()]}var l={serialize:n,deserialize:i,register:s,lookup:r},c={};t.exports=l,l.register("application/json",function(e){try{return JSON.stringify(e)}catch(t){return t.message}},function(e){try{return JSON.parse(e)}catch(t){return t.message}}),l.register("application/x-www-form-urlencoded",function(e){var t=encodeURIComponent,r=[];for(var n in e)if(null===e[n])r.push(n+"=");else if(Array.isArray(e[n]))for(var i=0;i<e[n].length;i++)r.push(n+"[]="+t(e[n][i]));else if("object"==typeof e[n])for(var s in e[n])r.push(n+"["+s+"]="+t(e[n][s]));else r.push(n+"="+t(e[n]));return r.join("&")},function(e){for(var t=e.split("&"),r={},n=0;n<t.length;n++){var i=t[n].split("="),s=decodeURIComponent(i[0]),o=decodeURIComponent(i[1]),a=/\[\]$/.test(s),u=s.match(/^(.+)\[([^\]]+)\]$/);if("true"===o?o=!0:"false"===o?o=!1:+o==o&&(o=+o),u){s=u[1];var l=u[2];r[s]=r[s]||{},r[s][l]=o}else a?(s=s.substring(0,s.length-2),r[s]=r[s]||[],r[s].push(o)):r[s]=o}return r}),l.register("text/event-stream",function(e){var t="";return"undefined"!=typeof e.event&&(t+="event: "+e.event+"\r\n"),"undefined"!=typeof e.data&&(t+="data: "+JSON.stringify(e.data)+"\r\n"),t+"\r\n"},function(e){var t={};if(e.split("\r\n").forEach(function(e){/^[\s]*$/.test(e)||(e=u(e),e[0]&&(t[e[0]]=e[1]))}),t.data)try{t.data=JSON.parse(t.data)}catch(r){}return t})},{}],10:[function(e,t){function r(e,t){t||(t={}),"undefined"==typeof t.links&&(t.links=!0);var r=[];return t.links&&(r=r.concat(Array.prototype.slice.call(e.querySelectorAll("link")))),t.anchors&&(r=r.concat(Array.prototype.slice.call(e.querySelectorAll("a")))),r.map(function(e){for(var t={},r=0;r<e.attributes.length;r++)t[e.attributes[r].name]=e.attributes[r].value;return t})}function n(e,t){return e?(w&&e instanceof Document&&(e=r(e)),e.parsedHeaders&&(e=e.parsedHeaders.link),"string"==typeof t&&(t={rel:t}),Array.isArray(e)?e.filter(function(e){return i(e,t)}):[]):[]}function i(e,t){"string"==typeof t&&(t={rel:t});for(var r in t)if("function"==typeof t[r]){if(!t[r].call(null,e[r],r))return!1}else if("rel"==r)for(var n=t.rel.split(/\s+/),i=0;i<n.length;i++){var s=!0;if("!"==n[i].charAt(0)&&(n[i]=n[i].slice(1),s=!1),RegExp("(\\s|^)(.*//)?"+n[i]+"(\\s|$)","i").test(e.rel)!==s)return!1}else if("undefined"==typeof e[r]){if(RegExp(j+r+E,"i").test(e.href)===!0)continue;if(t[r])return!1}else if(t[r]&&t[r].indexOf&&0===t[r].indexOf("!")){if(e[r]==t[r].slice(1))return!1}else if(e[r]!=t[r])return!1;return!0}function s(e,t){var r=t.filter(function(t){return a(e,t)}).sort(function(e,t){return e.q>t.q?-1:1});return r[0]?r[0].q:0}function o(e,t){return"*"===e||e===t}function a(e,t){var r=u(e);if(t.params){var n=Object.keys(t.params);if(n.some(function(e){return!o(t.params[e],r.params[e])}))return null}return o(t.type,r.type)&&o(t.subtype,r.subtype)?t:void 0}function u(e){var t=e.match(/\s*(\S+)\/([^;\s]+)\s*(?:;(.*))?/);if(!t)return null;var r=t[1],n=t[2],i=""+r+"/"+n,s={},o=1;return t[3]&&(s=t[3].split(";").map(function(e){return e.trim().split("=")}).reduce(function(e,t){return e[t[0]]=t[1],e},s),null!==s.q&&(o=parseFloat(s.q),delete s.q)),{type:r,subtype:n,params:s,q:o,full:i}}function l(e){return e.split(",").map(function(e){return u(e.trim())}).filter(function(e){return e&&e.q>0})}function c(e,t){return"object"==typeof e&&(e=e.headers.accept),e=l(e||""),t?(Array.isArray(t)||(t=[t]),t.map(function(t){return t=b.lookup(t),[t,s(t,e)]}).filter(function(e){return e[1]>0}).sort(function(e,t){return e[1]===t[1]?0:e[1]>t[1]?-1:1}).map(function(e){return e[0]})):e.map(function(e){return e.full})}function f(e,t){return c(e,t)[0]}function p(){var e=Array.prototype.map.call(arguments,function(e,t){e=""+e;var r=0,n=e.length;return"/"==e?"":(0!==t&&"/"===e.charAt(0)&&(r+=1),"/"===e.charAt(n-1)&&(n-=1),e.substring(r,n))});return e.join("/")}function h(e){return A.test(e)}function d(e){return C.test(e)}function m(e,t){"string"==typeof e&&(e=v(e));var r=e.protocol?e.protocol+"://":!1;if(r||(r=0===e.source.indexOf("//")?"//":0===e.source.indexOf("||")?"||":"http://"),"/"==t.charAt(0))return r+e.authority+t;for(var n=e.path,i=n.split("/"),s=t.split("/"),o=0,a=s.length;a>o;o++)"."!=s[o]&&(".."==s[o]?i.pop():i.push(s[o]));return p(r+e.authority,i.join("/"))}function v(e){if("object"==typeof e&&(e.url?e=e.url:(e.headers&&e.headers.host||e.path)&&(e=p(e.headers.host,e.path))),"data:"==e.slice(0,5))return{protocol:"data",source:e};for(var t=v.options,r=t.parser[t.strictMode?"strict":"loose"].exec(e),n={},i=15;i--;)n[t.key[i]]=r[i]||"";return n[t.q.name]={},n[t.key[13]].replace(t.q.parser,function(e,r,i){r&&(n[t.q.name][r]=i)}),n}function y(e){if(!e)return[];var t=e.indexOf("||");-1!==t&&(e=e.slice(t+2));for(var r=e.split("|"),n=1;n<r.length;n++){for(var i={},s=r[n].split(","),o=0;o<s.length;o++){var a=s[o].split("=");0===o?(i.rel=a[0].replace(/\+/g," "),a[1]&&(i.id=a[1])):i[a[0]]=decodeURIComponent(a[1]).replace(/\+/g," ")}r[n]=i}return r.length>6&&(r.length=6),r[0]||r.shift(),r}function g(e,t){Array.isArray(t)||(t=[t]);for(var r=t.length-1;r>=0;r--){var n=t[r];e=x.parse(n).expand({uri:e})}return e}e("../promises.js").promise;var b=e("./content-types.js"),x=e("./uri-template.js"),w="undefined"!=typeof Document,j="\\{([^\\}]*)[\\+\\#\\.\\/\\;\\?\\&]?",E="(\\,|\\})",A=/^(#)|((http(s|l)?:)?\/\/)|((nav:)?\|\|)|(data:)/,C=/^(nav:)?\|?\|/i;v.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","srcPath","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@\/]*)(?::([^:@\/]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@\/]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*)(?::([^:@\/]*))?)?@)?([^:\/\(?#]*)(?::(\d*))?(?:\(([^\)]+)\))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},t.exports={extractDocumentLinks:r,queryLinks:n,queryLink:i,preferredTypes:c,preferredType:f,parseMediaType:u,parseAcceptHeader:l,joinUri:p,joinRelPath:m,isAbsUri:h,isNavSchemeUri:d,parseUri:v,parseNavUri:y,makeProxyUri:g}},{"../promises.js":4,"./content-types.js":9,"./uri-template.js":18}],11:[function(e,t){function r(e,t){if(!t||"object"!=typeof t||!e)return t;var r=s(e,"serializer");if(!r)return t;try{return r(t)}catch(n){return console.warn("Failed to serialize header",e,t),t}}function n(e,t){if(!t||"string"!=typeof t||!e)return t;var r=s(e,"deserializer");if(!r)return t;try{return r(t)}catch(n){return console.warn("Failed to deserialize header",e,t),t}}function i(e,t,r){u[e.toLowerCase()]={serializer:t,deserializer:r}}function s(e,t){var r=u[e.toLowerCase()];return r?r[t]:null}var o=e("./helpers.js"),a={serialize:r,deserialize:n,register:i},u={};t.exports=a;var l=/<(.*?)>(?:;[\s]*(.*?)((,(?=[\s]*<))|$))/g,c=/([\-a-z0-9_\.]+)=?(?:(?:"([^"]+)")|([^;\s]+))?/g;a.register("link",function(e){var t=[];return e.forEach(function(e){var r=["<"+e.href+">"];for(var n in e)"href"!=n&&null!==e[n]&&("boolean"==typeof e[n]&&e[n]?r.push(n):r.push(n+'="'+e[n]+'"'));t.push(r.join("; "))}),t.join(", ")},function(e){for(var t,r,n,i=[];t=l.exec(e);){for(n={href:t[1]};r=c.exec(t[2]);)n[r[1]]=r[2]||r[3]||!0;i.push(n)}return i}),a.register("accept",function(e){return e.map(function(e){var t=[e.full];1!==e.q&&t.push("q="+e.q);for(var r in e.params)t.push(r+"="+e.params[r]);return t.join("; ")}).join(", ")},o.parseAcceptHeader)},{"./helpers.js":10}],12:[function(e,t){function r(e,t){"#"!=e.charAt(0)&&(e="#"+e),e=new RegExp("^("+e+")$","i"),a.push({path:e,handler:t})}function n(){return a}e("./helpers.js");var i=e("./schemes.js");e("./content-types.js");var s=e("./incoming-request.js"),o=e("./response.js"),a=[];i.register("#",function(e,t){var r=local.parseUri("/"+(e.urld.anchor||""));if(r.query){var n=local.contentTypes.deserialize("application/x-www-form-urlencoded",r.query);e.param(n)}e.path="#"+r.path.slice(1);for(var i,u,l=0;l<a.length;l++)if(i=a[l].path.exec(e.path)){u=a[l].handler;break}e.pathd=i;var c=new s(e.headers),f=new o;e.wireUp(c,!0),f.wireUp(t,!0),e.isBinary&&console.warn("Got virtual request with binary=true - sorry, not currently supported",e),u?u(c,f):f.s404().end()}),t.exports={at:r,getRoutes:n}},{"./content-types.js":9,"./helpers.js":10,"./incoming-request.js":13,"./response.js":16,"./schemes.js":17}],13:[function(e,t){function r(e){n.EventEmitter.call(this);var t=this,r=function(e,r){Object.defineProperty(t,e,{value:r,writable:!0})};this.method=e.method?e.method.toUpperCase():"GET",this[this.method]=!0,this.params=e.params||{},this.isBinary=!1;for(var s in e){var o=s.charAt(0);if(o===o.toUpperCase()){this[s]=e[s];var a=i.deserialize(s,e[s]);a&&"string"!=typeof a&&(this[s.toLowerCase()]=a)}}r("isConnOpen",!0),r("isStarted",!0),r("isEnded",!1),this.on("end",function(){t.isEnded=!0})}var n=e("../util");e("./helpers.js");var i=e("./http-headers.js"),s=e("./content-types.js");r.prototype=Object.create(n.EventEmitter.prototype),t.exports=r,r.prototype.buffer=function(e){if("undefined"==typeof this._buffer){var t=this;this._buffer="",this.body=null,this.on("data",function(e){"string"==typeof e?t._buffer+=e:t._buffer=e}),this.on("end",function(){t.body=t.ContentType?s.deserialize(t.ContentType,t._buffer):t._buffer})}this.on("end",e)}},{"../util":8,"./content-types.js":9,"./helpers.js":10,"./http-headers.js":11}],14:[function(e,t){function r(){n.EventEmitter.call(this);var e=this,t=function(t,r){Object.defineProperty(e,t,{value:r,writable:!0})};this.status=0,this.reason=void 0,t("latency",void 0),t("isConnOpen",!0),t("isStarted",!0),t("isEnded",!1),this.on("end",function(){e.isEnded=!0})}var n=e("../util"),i=e("./helpers.js"),s=e("./http-headers.js"),o=e("./content-types.js");r.prototype=Object.create(n.EventEmitter.prototype),t.exports=r,r.prototype.buffer=function(e){if("undefined"==typeof this._buffer){var t=this;this._buffer="",this.body="",this.on("data",function(e){"string"==typeof e?t._buffer+=e:t._buffer=e}),this.on("end",function(){t.body=t.ContentType?o.deserialize(t.ContentType,t._buffer):t._buffer})}this.on("end",e)},r.prototype.processHeaders=function(e,t){this.status=t.status,this.reason=t.reason;for(var r in t){var n=r.charAt(0);if(n===n.toUpperCase()){this[r]=t[r];var o=s.deserialize(r,t[r]);o&&"string"!=typeof o&&(this[r.toLowerCase()]=o)}}this.link&&(this.links=this.link,delete this.link,this.links.forEach(function(t){i.isAbsUri(t.href)||(t.href=e.isVirtual?"#"+t.href:i.joinRelPath(e.urld,t.href))}))}},{"../util":8,"./content-types.js":9,"./helpers.js":10,"./http-headers.js":11}],15:[function(e,t){function r(e){o.EventEmitter.call(this),a.Promise.call(this),e||(e={}),"string"==typeof e&&(e={url:e}),this.headers=e,this.headers.method=this.headers.method?this.headers.method.toUpperCase():"GET",this.headers.params=this.headers.params||{},this.isBinary=!1,this.isVirtual=void 0,this.isBufferingResponse=!1,this.isConnOpen=!0,this.isStarted=!1,this.isEnded=!1}function n(e){return e.replace(p,function(e,t,r){return r.toUpperCase()})}function i(e,t){t.status>=200&&t.status<400?e.fulfill(t):t.status>=400&&t.status<600||0===t.status?e.reject(t):e.fulfill(t)}function s(e){var t=/^([^.^:]*):/.exec(e);return t?t[1]:"http"}var o=e("../util"),a=e("../promises.js"),u=e("./helpers.js"),l=e("./schemes.js"),c=e("./content-types.js"),f=e("./incoming-response.js");r.prototype=Object.create(o.EventEmitter.prototype),o.mixin.call(r.prototype,a.Promise.prototype),t.exports=r,r.prototype.header=function(e,t){return e=n(e),("Accept"==e||"ContentType"==e)&&(t=c.lookup(t)),this.headers[e]=t,this},["Accept","Authorization","ContentType","Expect","From","Pragma"].forEach(function(e){r.prototype[e]=function(t){return this.header(e,t)}});var p=/(^|-)(.)/g;r.prototype.param=function(e,t){if(e&&"object"==typeof e)for(var r in e)this.param(r,e[r]);else this.headers.params[e]=t;return this},r.prototype.setTimeout=function(e){var t=this;if(!this.__timeoutId)return this.__timeoutId=setTimeout(function(){t.isConnOpen&&t.close(),delete t.__timeoutId},e),this},r.prototype.setBinary=function(e){return this.isBinary="boolean"==typeof e?e:!0,this},r.prototype.setVirtual=function(e){return this.isVirtual="boolean"==typeof e?e:!0,this},r.prototype.bufferResponse=function(e){return this.isBufferingResponse="boolean"==typeof e?e:!0,this},r.prototype.pipe=function(t,r,n){var i=this;r=r||function(e){return e},n=n||function(e){return e},promise(t).always(function(t){if(t instanceof e("./incoming-request")){i.headers.method||(i.headers.method=t.method),i.headers.url||(i.headers.url=t.url);for(var s in t)s.charAt(0)!=s.charAt(0).toUpperCase()||s in i.headers||"_"==s.charAt(0)||i.header(s,r(s,t[s]))}console.log(t.isEnded,t),t.isEnded?i.end(n(t.body)):(t.on("data",function(e){i.write(n(e))}),t.on("end",function(){i.end()}))})},r.prototype.wireUp=function(e,t){if(t){var r=function(e){return function(t){o.nextTick(e.bind(null,t))}};this.on("headers",r(e.emit.bind(e,"headers"))),this.on("data",r(e.emit.bind(e,"data"))),this.on("end",r(e.emit.bind(e,"end")))}else this.on("headers",e.emit.bind(e,"headers")),this.on("data",e.emit.bind(e,"data")),this.on("end",e.emit.bind(e,"end"))},r.prototype.start=function(){var e=this;if(!this.isConnOpen)return this;if(this.isStarted)return this;if(!this.headers||!this.headers.url)throw"No URL on request";"undefined"==typeof this.isVirtual&&(this.isVirtual=-1!==this.headers.url.indexOf("#")),this.urld=u.parseUri(this.headers.url);var t=Date.now(),r=new f;r.on("headers",r.processHeaders.bind(r,this)),r.on("end",function(){r.latency=Date.now()-t}),this.on("close",function(){r.emit("close")}),r.on("close",function(){e.close()});var n=i.bind(null,this,r);this.isBufferingResponse?r.buffer(n):r.on("headers",n),r.on("close",n);var o=e.isVirtual?"#":s(e.headers.url),a=l.get(o);if(a)a(e,r);else{var c=new Response;c.wireUp(r),c.status(0,'unsupported scheme "'+o+'"').end()}return this.isStarted=!0,this},r.prototype.write=function(e){return this.isConnOpen?(this.isStarted||this.start(),this.isEnded?this:(this.emit("data",e),this)):this},r.prototype.end=function(e){return this.isConnOpen?this.isEnded?this:(this.isStarted||this.start(),"undefined"!=typeof e&&this.write(e),this.isEnded=!0,this.emit("end"),this):this},r.prototype.close=function(){return this.isConnOpen?(this.isConnOpen=!1,this.emit("close"),this.clearEvents(),this):this}},{"../promises.js":4,"../util":8,"./content-types.js":9,"./helpers.js":10,"./incoming-request":13,"./incoming-response.js":14,"./schemes.js":17}],16:[function(e,t){function r(){i.EventEmitter.call(this),this.headers={},this.headers.status=0,this.headers.reason="",this.isBinary=!1,this.isConnOpen=!0,this.isStarted=!1,this.isEnded=!1}function n(e){return e.replace(u,function(e,t,r){return r.toUpperCase()})}var i=e("../util"),s=e("../promises.js").promise;e("./helpers.js");var o=e("./content-types.js");t.exports=r,r.prototype=Object.create(i.EventEmitter.prototype),r.prototype.status=function(e,t){return this.headers.status=e,this.headers.reason=t,this};for(var a=200;599>=a;a++)!function(e){r.prototype["s"+e]=function(t){return this.status(e,t)}}(a);r.prototype.header=function(e,t){return e=n(e),"ContentType"==e&&(t=o.lookup(t)),this.headers[e]=t,this},["Allow","ContentType","Link","Location","Pragma"].forEach(function(e){r.prototype[e]=function(t){return this.header(e,t)}});var u=/(^|-)(.)/g;r.prototype.pipe=function(t,r,n){var i=this;r=r||function(e){return e},n=n||function(e){return e},s(t).always(function(t){if(t instanceof e("./incoming-response")){i.headers.status||i.status(t.status,t.reason);for(var s in t)s.charAt(0)!=s.charAt(0).toUpperCase()||s in i.headers||"_"==s.charAt(0)||i.header(s,r(s,t[s]))}console.log(t.isEnded,t),t.isEnded?i.end(n(t.body)):(t.on("data",function(e){i.write(n(e))
}),t.on("end",function(){i.end()}))})},r.prototype.wireUp=function(e,t){if(t){var r=function(e){return function(t){i.nextTick(e.bind(null,t))}};this.on("headers",r(e.emit.bind(e,"headers"))),this.on("data",r(e.emit.bind(e,"data"))),this.on("end",r(e.emit.bind(e,"end"))),this.on("close",r(e.emit.bind(e,"close")))}else this.on("headers",e.emit.bind(e,"headers")),this.on("data",e.emit.bind(e,"data")),this.on("end",e.emit.bind(e,"end")),this.on("close",e.emit.bind(e,"close"))},r.prototype.start=function(){return this.isConnOpen?this.isEnded?this:this.isStarted?this:(this.emit("headers",this.headers),this.isStarted=!0,this):this},r.prototype.write=function(e){return this.isConnOpen?this.isEnded?this:(this.isStarted||this.start(),this.emit("data",e),this):this},r.prototype.end=function(e){return this.isConnOpen?this.isEnded?this:(this.isStarted||this.start(),"undefined"!=typeof e&&this.write(e),this.isEnded=!0,this.emit("end"),this.close(),this):this},r.prototype.close=function(){return this.isConnOpen?(this.isConnOpen=!1,this.emit("close"),this.clearEvents(),this):this}},{"../promises.js":4,"../util":8,"./content-types.js":9,"./helpers.js":10,"./incoming-response":14}],17:[function(e,t){function r(e,t){if(e&&Array.isArray(e))for(var n=0,i=e.length;i>n;n++)r(e[n],t);else f[e]=t}function n(e){delete f[e]}function i(e){return f[e]}function s(e){var t={};for(var r in e){var n=r.charAt(0);if(e.hasOwnProperty(r)&&n===n.toUpperCase()){var i=r.replace(p,function(e,t,r){return t+"-"+r});t[i]=e[r]}}return t}e("../util");var o=e("./helpers.js"),a=e("./content-types.js"),u=e("./http-headers.js"),l=e("./response.js"),c={register:r,unregister:n,get:i},f={};t.exports=c,c.register(["http","https"],function(e,t){var r=o.parseUri(e.headers.url);if(Object.keys(e.headers.params).length){var n=a.serialize("application/x-www-form-urlencoded",e.headers.params);n&&(r.query?r.query+="&"+n:r.query=n,r.relative=r.path+"?"+r.query+(r.anchor?"#"+r.anchor:""))}var i=(r.protocol?r.protocol+"://":"//")+r.authority+r.relative,c=new XMLHttpRequest;c.open(e.headers.method,i,!0),e.isBinary&&(c.responseType="arraybuffer",e.stream&&console.warn("Got HTTP/S request with isBinary=true and stream=true - sorry, not supported, binary responses must be buffered (its a browser thing)",request));var f=s(e.headers);for(var p in f)null!==f[p]&&c.setRequestHeader(p,u.serialize(p,f[p]));var h="";e.on("data",function(e){"string"==typeof e?h+=e:h=e}),e.on("end",function(){c.send(h)}),e.on("close",function(){c.readyState!==XMLHttpRequest.DONE&&(c.aborted=!0,c.abort())});var d=0,m=0,v=!1,y=new l;y.wireUp(t),c.onreadystatechange=function(){if(c.readyState>=XMLHttpRequest.HEADERS_RECEIVED&&!v){if(v=!0,0!==c.status)if(c.getAllResponseHeaders())c.getAllResponseHeaders().split("\n").forEach(function(e){if(e){var t=e.replace("\r","").split(": ");y.header(t[0],t.slice(1).join(": "))}});else{var r=function(e){var t=c.getResponseHeader(e);t&&y.header(e,t)};r("Accept-Ranges"),r("Age"),r("Allow"),r("Cache-Control"),r("Connection"),r("Content-Encoding"),r("Content-Language"),r("Content-Length"),r("Content-Location"),r("Content-MD5"),r("Content-Disposition"),r("Content-Range"),r("Content-Type"),r("Date"),r("ETag"),r("Expires"),r("Last-Modified"),r("Link"),r("Location"),r("Pragma"),r("Refresh"),r("Retry-After"),r("Server"),r("Set-Cookie"),r("Trailer"),r("Transfer-Encoding"),r("Vary"),r("Via"),r("Warning"),r("WWW-Authenticate")}y.status(c.status,c.statusText),y.start(),e.isBinary||(d=setInterval(function(){var e=c.response.length;if(e>m){var t=c.response.slice(m);m=e,y.write(t)}},50))}if(c.readyState===XMLHttpRequest.DONE)if(d&&clearInterval(d),0===t.status||0!==c.status||c.aborted){if(c.response)if("string"==typeof c.response){var n=c.response.length;n>m&&y.write(c.response.slice(m))}else y.write(c.response);y.end()}else console.debug("XHR looks like it timed out; treating it as a premature close"),y.close()}});var p=/([a-z])([A-Z])/g;c.register("data",function(e,t){for(var r,n=e.headers.url.indexOf(":"),i=e.headers.url.indexOf(","),s=e.headers.url.slice(n+1,i).split(";"),o=s.shift(),a=!1;r=s.shift();)"base64"==r&&(a=!0);var u=e.headers.url.slice(i+1);u||(u=""),u=a?atob(u):decodeURIComponent(u);var c=new l;c.wireUp(t),c.s200().ContentType(o),c.end(u)})},{"../util":8,"./content-types.js":9,"./helpers.js":10,"./http-headers.js":11,"./response.js":16}],18:[function(e,t){!function(e){"use strict";function t(e){var r;if(null===e||void 0===e)return!1;if(n.isArray(e))return e.length>0;if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return!0;for(r in e)if(e.hasOwnProperty(r)&&t(e[r]))return!0;return!1}var r=function(){function e(e){this.options=e}return e.prototype.toString=function(){return JSON&&JSON.stringify?JSON.stringify(this.options):this.options},e}(),n=function(){function e(e){return"[object Array]"===Object.prototype.toString.apply(e)}function t(e){return"[object String]"===Object.prototype.toString.apply(e)}function r(e){return"[object Number]"===Object.prototype.toString.apply(e)}function n(e){return"[object Boolean]"===Object.prototype.toString.apply(e)}function i(e,t){var r,n="",i=!0;for(r=0;r<e.length;r+=1)i?i=!1:n+=t,n+=e[r];return n}function s(e,t){for(var r=[],n=0;n<e.length;n+=1)r.push(t(e[n]));return r}function o(e,t){for(var r=[],n=0;n<e.length;n+=1)t(e[n])&&r.push(e[n]);return r}function a(e){if("object"!=typeof e||null===e)return e;Object.freeze(e);var t,r;for(r in e)e.hasOwnProperty(r)&&(t=e[r],"object"==typeof t&&u(t));return e}function u(e){return"function"==typeof Object.freeze?a(e):e}return{isArray:e,isString:t,isNumber:r,isBoolean:n,join:i,map:s,filter:o,deepFreeze:u}}(),i=function(){function e(e){return e>="a"&&"z">=e||e>="A"&&"Z">=e}function t(e){return e>="0"&&"9">=e}function r(e){return t(e)||e>="a"&&"f">=e||e>="A"&&"F">=e}return{isAlpha:e,isDigit:t,isHexDigit:r}}(),s=function(){function e(e){return e.length>1?e:"0"+e}function t(t){var r,n,i="",s=a.encode(t);for(n=0;n<s.length;n+=1)r=s.charCodeAt(n),i+="%"+e(r.toString(16).toUpperCase());return i}function r(e,t){return"%"===e.charAt(t)&&i.isHexDigit(e.charAt(t+1))&&i.isHexDigit(e.charAt(t+2))}function n(e,t){return parseInt(e.substr(t,2),16)}function s(e){if(!r(e,0))return!1;var t=n(e,1),i=a.numBytes(t);if(0===i)return!1;for(var s=1;i>s;s+=1)if(!r(e,3*s)||!a.isValidFollowingCharCode(n(e,3*s+1)))return!1;return!0}function o(e,t){var i=e.charAt(t);if(!r(e,t))return i;var s=n(e,t+1),o=a.numBytes(s);if(0===o)return i;for(var u=1;o>u;u+=1)if(!r(e,t+3*u)||!a.isValidFollowingCharCode(n(e,t+3*u+1)))return i;return e.substr(t,3*o)}var a={encode:function(e){return unescape(encodeURIComponent(e))},numBytes:function(e){return 127>=e?1:e>=194&&223>=e?2:e>=224&&239>=e?3:e>=240&&244>=e?4:0},isValidFollowingCharCode:function(e){return e>=128&&191>=e}};return{encodeCharacter:t,isPctEncoded:s,pctCharAt:o}}(),o=function(){function e(e){return i.isAlpha(e)||i.isDigit(e)||"_"===e||s.isPctEncoded(e)}function t(e){return i.isAlpha(e)||i.isDigit(e)||"-"===e||"."===e||"_"===e||"~"===e}function r(e){return":"===e||"/"===e||"?"===e||"#"===e||"["===e||"]"===e||"@"===e||"!"===e||"$"===e||"&"===e||"("===e||")"===e||"*"===e||"+"===e||","===e||";"===e||"="===e||"'"===e}return{isVarchar:e,isUnreserved:t,isReserved:r}}(),a=function(){function e(e,t){var r,n="",i="";for(("number"==typeof e||"boolean"==typeof e)&&(e=e.toString()),r=0;r<e.length;r+=i.length)i=e.charAt(r),n+=o.isUnreserved(i)||t&&o.isReserved(i)?i:s.encodeCharacter(i);return n}function t(t){return e(t,!0)}function r(e,t){var r=s.pctCharAt(e,t);return r.length>1?r:o.isReserved(r)||o.isUnreserved(r)?r:s.encodeCharacter(r)}function n(e){var t,r="",n="";for(t=0;t<e.length;t+=n.length)n=s.pctCharAt(e,t),r+=n.length>1?n:o.isReserved(n)||o.isUnreserved(n)?n:s.encodeCharacter(n);return r}return{encode:e,encodePassReserved:t,encodeLiteral:n,encodeLiteralCharacter:r}}(),u=function(){function e(e){t[e]={symbol:e,separator:"?"===e?"&":""===e||"+"===e||"#"===e?",":e,named:";"===e||"&"===e||"?"===e,ifEmpty:"&"===e||"?"===e?"=":"",first:"+"===e?"":e,encode:"+"===e||"#"===e?a.encodePassReserved:a.encode,toString:function(){return this.symbol}}}var t={};return e(""),e("+"),e("#"),e("."),e("/"),e(";"),e("?"),e("&"),{valueOf:function(e){return t[e]?t[e]:"=,!@|".indexOf(e)>=0?null:t[""]}}}(),l=function(){function e(e){this.literal=a.encodeLiteral(e)}return e.prototype.expand=function(){return this.literal},e.prototype.toString=e.prototype.expand,e}(),c=function(){function e(e){function t(){var t=e.substring(h,l);if(0===t.length)throw new r({expressionText:e,message:"a varname must be specified",position:l});p={varname:t,exploded:!1,maxLength:null},h=null}function n(){if(d===l)throw new r({expressionText:e,message:"after a ':' you have to specify the length",position:l});p.maxLength=parseInt(e.substring(d,l),10),d=null}var a,l,c=[],p=null,h=null,d=null,m="";for(a=function(t){var n=u.valueOf(t);if(null===n)throw new r({expressionText:e,message:"illegal use of reserved operator",position:l,operator:t});return n}(e.charAt(0)),l=a.symbol.length,h=l;l<e.length;l+=m.length){if(m=s.pctCharAt(e,l),null!==h){if("."===m){if(h===l)throw new r({expressionText:e,message:"a varname MUST NOT start with a dot",position:l});continue}if(o.isVarchar(m))continue;t()}if(null!==d){if(l===d&&"0"===m)throw new r({expressionText:e,message:"A :prefix must not start with digit 0",position:l});if(i.isDigit(m)){if(l-d>=4)throw new r({expressionText:e,message:"A :prefix must have max 4 digits",position:l});continue}n()}if(":"!==m)if("*"!==m){if(","!==m)throw new r({expressionText:e,message:"illegal character",character:m,position:l});c.push(p),p=null,h=l+1}else{if(null===p)throw new r({expressionText:e,message:"exploded without varspec",position:l});if(p.exploded)throw new r({expressionText:e,message:"exploded twice",position:l});if(p.maxLength)throw new r({expressionText:e,message:"an explode (*) MUST NOT follow to a prefix",position:l});p.exploded=!0}else{if(null!==p.maxLength)throw new r({expressionText:e,message:"only one :maxLength is allowed per varspec",position:l});if(p.exploded)throw new r({expressionText:e,message:"an exploeded varspec MUST NOT be varspeced",position:l});d=l+1}}return null!==h&&t(),null!==d&&n(),c.push(p),new f(e,a,c)}function t(t){var n,i,s=[],o=null,a=0;for(n=0;n<t.length;n+=1)if(i=t.charAt(n),null===a){if(null===o)throw new Error("reached unreachable code");if("{"===i)throw new r({templateText:t,message:"brace already opened",position:n});if("}"===i){if(o+1===n)throw new r({templateText:t,message:"empty braces",position:o});try{s.push(e(t.substring(o+1,n)))}catch(u){if(u.prototype===r.prototype)throw new r({templateText:t,message:u.options.message,position:o+u.options.position,details:u.options});throw u}o=null,a=n+1}}else{if("}"===i)throw new r({templateText:t,message:"unopened brace closed",position:n});"{"===i&&(n>a&&s.push(new l(t.substring(a,n))),a=null,o=n)}if(null!==o)throw new r({templateText:t,message:"unclosed brace",position:o});return a<t.length&&s.push(new l(t.substr(a))),new p(t,s)}return t}(),f=function(){function e(e){return JSON&&JSON.stringify?JSON.stringify(e):e}function r(e){if(!t(e))return!0;if(n.isString(e))return""===e;if(n.isNumber(e)||n.isBoolean(e))return!1;if(n.isArray(e))return 0===e.length;for(var r in e)if(e.hasOwnProperty(r))return!1;return!0}function i(e){var t,r=[];for(t in e)e.hasOwnProperty(t)&&r.push({name:t,value:e[t]});return r}function s(e,t,r){this.templateText=e,this.operator=t,this.varspecs=r}function o(e,t,r){var n="";if(r=r.toString(),t.named){if(n+=a.encodeLiteral(e.varname),""===r)return n+=t.ifEmpty;n+="="}return null!==e.maxLength&&(r=r.substr(0,e.maxLength)),n+=t.encode(r)}function u(e){return t(e.value)}function l(e,s,o){var l=[],c="";if(s.named){if(c+=a.encodeLiteral(e.varname),r(o))return c+=s.ifEmpty;c+="="}return n.isArray(o)?(l=o,l=n.filter(l,t),l=n.map(l,s.encode),c+=n.join(l,",")):(l=i(o),l=n.filter(l,u),l=n.map(l,function(e){return s.encode(e.name)+","+s.encode(e.value)}),c+=n.join(l,",")),c}function c(e,s,o){var l=n.isArray(o),c=[];return l?(c=o,c=n.filter(c,t),c=n.map(c,function(t){var n=a.encodeLiteral(e.varname);return n+=r(t)?s.ifEmpty:"="+s.encode(t)})):(c=i(o),c=n.filter(c,u),c=n.map(c,function(e){var t=a.encodeLiteral(e.name);return t+=r(e.value)?s.ifEmpty:"="+s.encode(e.value)})),n.join(c,s.separator)}function f(e,r){var s=[],o="";return n.isArray(r)?(s=r,s=n.filter(s,t),s=n.map(s,e.encode),o+=n.join(s,e.separator)):(s=i(r),s=n.filter(s,function(e){return t(e.value)}),s=n.map(s,function(t){return e.encode(t.name)+"="+e.encode(t.value)}),o+=n.join(s,e.separator)),o}return s.prototype.toString=function(){return this.templateText},s.prototype.expand=function(i){var s,a,u,p,h=[],d=!1,m=this.operator;for(s=0;s<this.varspecs.length;s+=1)if(a=this.varspecs[s],u=i[a.varname],null!==u&&void 0!==u)if(a.exploded&&(d=!0),p=n.isArray(u),"string"==typeof u||"number"==typeof u||"boolean"==typeof u)h.push(o(a,m,u));else{if(a.maxLength&&t(u))throw new Error("Prefix modifiers are not applicable to variables that have composite values. You tried to expand "+this+" with "+e(u));a.exploded?t(u)&&(m.named?h.push(c(a,m,u)):h.push(f(m,u))):(m.named||!r(u))&&h.push(l(a,m,u))}return 0===h.length?"":m.first+n.join(h,m.separator)},s}(),p=function(){function e(e,t){this.templateText=e,this.expressions=t,n.deepFreeze(this)}return e.prototype.toString=function(){return this.templateText},e.prototype.expand=function(e){var t,r="";for(t=0;t<this.expressions.length;t+=1)r+=this.expressions[t].expand(e);return r},e.parse=c,e.UriTemplateError=r,e}();e(p)}(function(e){t.exports=e})},{}]},{},[3]);